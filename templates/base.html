<!DOCTYPE html>
<html lang="{{ session.get('lang', 'en') }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>{% block title %}Kitaly â€” The Collector's Choice{% endblock %}</title>
    {% set canonical_lang = request.args.get('lang') %}
    <link rel="canonical"
        href="https://kitaly-official.com{{ request.path }}{% if canonical_lang %}?lang={{ canonical_lang }}{% endif %}">
    <link rel="alternate" hreflang="en" href="https://kitaly-official.com{{ request.path }}?lang=en">
    <link rel="alternate" hreflang="it" href="https://kitaly-official.com{{ request.path }}?lang=it">
    {% block head %}{% endblock %}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_io/favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="180x180"
        href="{{ url_for('static', filename='favicon_io/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32"
        href="{{ url_for('static', filename='favicon_io/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16"
        href="{{ url_for('static', filename='favicon_io/favicon-16x16.png') }}">

    <script>
        (function () {
            const storageKey = 'theme';
            const root = document.documentElement;

            let savedTheme = null;
            try {
                savedTheme = localStorage.getItem(storageKey);
            } catch (error) {
                savedTheme = null;
            }

            const initialTheme = savedTheme === 'dark' || savedTheme === 'light' ? savedTheme : 'light';
            root.classList.toggle('dark', initialTheme === 'dark');
            root.dataset.theme = initialTheme;
            root.style.colorScheme = initialTheme;
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        italy: {
                            50: '#f0f7ff',
                            100: '#e0effe',
                            600: '#0055A4',
                            700: '#004482',
                            900: '#002241',
                        },
                        premium: {
                            gold: '#D4AF37',
                            slate: '#0F172A',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        starPulse: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.85' },
                            '50%': { transform: 'scale(1.08)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --ui-bg: #fdfdfd;
            --ui-surface: #ffffff;
            --ui-surface-soft: #f8fafc;
            --ui-surface-muted: #f1f5f9;
            --ui-text: #0f172a;
            --ui-text-muted: #64748b;
            --ui-text-soft: #94a3b8;
            --ui-border: rgba(15, 23, 42, 0.10);
            --ui-border-soft: rgba(15, 23, 42, 0.06);
            --ui-overlay: rgba(15, 23, 42, 0.45);
            --ui-header-bg: rgba(255, 255, 255, 0.72);
            --ui-header-bg-scrolled: rgba(255, 255, 255, 0.92);
            --ui-header-border: rgba(15, 23, 42, 0.08);
            --ui-toggle-bg: #eef2f7;
            --ui-toggle-border: #d6deea;
            --ui-toggle-thumb: #ffffff;
            --ui-toggle-icon: #64748b;
            --ui-toggle-glow: rgba(0, 85, 164, 0.22);
        }

        html.dark {
            --ui-bg: #0f131a;
            --ui-surface: #151b24;
            --ui-surface-soft: #111923;
            --ui-surface-muted: #1b2432;
            --ui-text: #e8eef8;
            --ui-text-muted: #a4b0c4;
            --ui-text-soft: #7d8aa0;
            --ui-border: rgba(148, 163, 184, 0.24);
            --ui-border-soft: rgba(148, 163, 184, 0.16);
            --ui-overlay: rgba(2, 6, 23, 0.72);
            --ui-header-bg: rgba(12, 18, 27, 0.76);
            --ui-header-bg-scrolled: rgba(13, 20, 30, 0.92);
            --ui-header-border: rgba(148, 163, 184, 0.20);
            --ui-toggle-bg: #1f2a3a;
            --ui-toggle-border: #334155;
            --ui-toggle-thumb: #0f172a;
            --ui-toggle-icon: #cbd5e1;
            --ui-toggle-glow: rgba(148, 163, 184, 0.24);
        }

        html,
        body {
            @apply selection:bg-italy-100 selection:text-italy-600;
            color: var(--ui-text);
            background: var(--ui-bg);
            -webkit-font-smoothing: antialiased;
        }

        body {
            transition: background-color 300ms ease, color 300ms ease;
        }

        .theme-animating *,
        .theme-animating *::before,
        .theme-animating *::after {
            transition: background-color 300ms ease, border-color 300ms ease, color 300ms ease, box-shadow 300ms ease;
        }

        .header-glass {
            @apply sticky top-0 z-50 transition-all duration-300;
            background: var(--ui-header-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--ui-header-border);
        }

        .header-glass.scrolled {
            background: var(--ui-header-bg-scrolled);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }

        .text-gradient {
            background: linear-gradient(135deg, #0F172A 0%, #0055A4 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .player-issue-star {
            animation: starPulse 2.4s ease-in-out infinite;
        }

        .player-issue-star-title {
            font-size: 0.65em;
            line-height: 1;
            vertical-align: middle;
            transform: translateY(-0.06em);
        }

        .theme-toggle {
            position: relative;
            display: inline-flex;
            align-items: center;
            width: 4rem;
            height: 2.25rem;
            border-radius: 9999px;
            border: 1px solid var(--ui-toggle-border);
            background: var(--ui-toggle-bg);
            padding: 0.25rem;
            transition: all 300ms ease;
        }

        .theme-toggle:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px var(--ui-toggle-glow);
        }

        .theme-toggle-track {
            position: absolute;
            inset: 0;
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            align-items: center;
            padding-inline: 0.45rem;
            pointer-events: none;
        }

        .theme-toggle-icon {
            width: 0.9rem;
            height: 0.9rem;
            color: var(--ui-toggle-icon);
            transition: transform 300ms ease, opacity 300ms ease, color 300ms ease;
        }

        .theme-toggle-sun {
            justify-self: start;
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        .theme-toggle-moon {
            justify-self: end;
            opacity: 0.42;
            transform: rotate(-20deg) scale(0.9);
        }

        .theme-toggle-thumb {
            position: relative;
            z-index: 1;
            width: 1.6rem;
            height: 1.6rem;
            border-radius: 9999px;
            background: var(--ui-toggle-thumb);
            box-shadow: 0 2px 10px rgba(15, 23, 42, 0.16);
            transform: translateX(0);
            transition: transform 300ms ease, box-shadow 300ms ease, background-color 300ms ease;
        }

        html.dark .theme-toggle-thumb {
            transform: translateX(1.7rem);
            box-shadow: 0 3px 16px rgba(2, 6, 23, 0.55);
        }

        html.dark .theme-toggle-sun {
            opacity: 0.42;
            transform: rotate(20deg) scale(0.9);
        }

        html.dark .theme-toggle-moon {
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        .theme-switching-to-dark .theme-toggle-sun {
            color: #f4c84b;
            opacity: 0.95;
            transform: rotate(8deg) scale(1.05);
        }

        html.dark .text-slate-900 {
            color: #e8eef8 !important;
        }

        html.dark .text-slate-700 {
            color: #cbd5e1 !important;
        }

        html.dark .text-slate-600,
        html.dark .text-slate-500 {
            color: #a4b0c4 !important;
        }

        html.dark .text-slate-400,
        html.dark .text-slate-300,
        html.dark .text-slate-200 {
            color: #7d8aa0 !important;
        }

        html.dark .bg-white,
        html.dark .bg-white\/50,
        html.dark .bg-white\/70,
        html.dark .bg-white\/80 {
            background-color: var(--ui-surface) !important;
        }

        html.dark .bg-slate-50,
        html.dark .bg-slate-50\/50 {
            background-color: var(--ui-surface-soft) !important;
        }

        html.dark .bg-slate-100,
        html.dark .bg-slate-100\/50 {
            background-color: var(--ui-surface-muted) !important;
        }

        html.dark .bg-slate-900\/40 {
            background-color: var(--ui-overlay) !important;
        }

        html.dark .border-slate-50,
        html.dark .border-slate-100,
        html.dark .border-slate-200,
        html.dark .border-slate-300 {
            border-color: var(--ui-border) !important;
        }

        html.dark .border-slate-100\/50,
        html.dark .border-slate-100\/70,
        html.dark .border-slate-200\/50 {
            border-color: var(--ui-border-soft) !important;
        }

        html.dark .shadow-slate-100\/50,
        html.dark .shadow-slate-200\/50,
        html.dark .shadow-slate-200 {
            --tw-shadow-color: rgba(2, 6, 23, 0.45) !important;
        }

        html.dark #cookie-consent,
        html.dark [data-consent],
        html.dark .consent-widget {
            background-color: var(--ui-surface) !important;
            border-color: var(--ui-border) !important;
            color: var(--ui-text) !important;
        }

        @media (prefers-reduced-motion: reduce) {
            .theme-toggle,
            .theme-toggle-icon,
            .theme-toggle-thumb,
            body {
                transition: none !important;
            }

            .theme-animating *,
            .theme-animating *::before,
            .theme-animating *::after {
                transition: none !important;
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col font-sans">
    {% from "components/contact_chips.html" import contact_action_chips %}
    <nav id="main-nav" class="header-glass">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center">
                    <a href="{{ url_for('public.catalog') }}" class="group flex items-center gap-4">
                        <div class="flex flex-col">
                            <span
                                class="font-display font-bold italic text-3xl tracking-tighter leading-none group-hover:text-italy-600 transition-all duration-500">Kitaly</span>
                            <span class="text-[9px] font-bold tracking-[0.3em] text-slate-400 uppercase ml-0.5 mt-1">{{
                                _('Archive') }}</span>
                        </div>
                    </a>
                </div>

                <div class="flex items-center gap-6">
                    <div class="hidden md:flex items-center gap-10">
                        <a href="{{ url_for('public.catalog') }}"
                            class="text-sm font-semibold tracking-wide text-slate-600 hover:text-italy-600 transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-italy-600 after:transition-all hover:after:w-full">
                            {{ _('Catalogue') }}
                        </a>
                    </div>

                    <button id="theme-toggle" type="button" role="switch" aria-checked="false"
                        aria-label="Toggle dark mode" title="Toggle dark mode" class="theme-toggle">
                        <span class="theme-toggle-track" aria-hidden="true">
                            <svg class="theme-toggle-icon theme-toggle-sun" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="4"></circle>
                                <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path>
                            </svg>
                            <svg class="theme-toggle-icon theme-toggle-moon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M14.5 3.2a8.9 8.9 0 1 0 6.3 12.5 7.3 7.3 0 0 1-6.3-12.5Z"></path>
                            </svg>
                        </span>
                        <span class="theme-toggle-thumb" aria-hidden="true"></span>
                    </button>

                    {% if not (request.endpoint and request.endpoint.startswith('admin.')) %}
                    <div class="flex items-center gap-3 md:pl-6 md:border-l md:border-slate-200">
                        <div class="flex bg-slate-100/50 p-1 rounded-full border border-slate-200/50">
                            <a href="?lang=it"
                                class="px-3 py-1 text-[10px] font-bold rounded-full transition-all {{ 'bg-white text-italy-600 shadow-sm' if session.get('lang') == 'it' else 'text-slate-400 hover:text-slate-600' }}">IT</a>
                            <a href="?lang=en"
                                class="px-3 py-1 text-[10px] font-bold rounded-full transition-all {{ 'bg-white text-italy-600 shadow-sm' if session.get('lang') != 'it' else 'text-slate-400 hover:text-slate-600' }}">EN</a>
                        </div>
                    </div>
                    {% endif %}
                </div>

            </div>
        </div>
    </nav>

    <main class="flex-grow animate-fade-in">
        <div class="max-w-7xl mx-auto px-6 lg:px-12 pt-6">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div
                class="mb-4 flex items-center justify-between p-4 rounded-2xl border bg-white/50 backdrop-blur-sm animate-slide-up
                                    {% if category == 'error' %}border-red-100 text-red-600{% else %}border-emerald-100 text-emerald-600{% endif %}">
                <div class="flex items-center gap-3">
                    <i data-lucide="{% if category == 'error' %}alert-circle{% else %}check-circle{% endif %}"
                        class="w-5 h-5"></i>
                    <span class="text-sm font-medium">{{ message }}</span>
                </div>
                <button onclick="this.parentElement.remove()" class="opacity-40 hover:opacity-100 transition-opacity">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
    </main>

    <footer class="mt-20 border-t border-slate-100 bg-slate-50/50">
        <div class="max-w-7xl mx-auto px-6 lg:px-12 py-16">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8">
                <div class="flex flex-col items-center md:items-start gap-2">
                    <div class="flex items-center gap-3">
                        <span class="font-display font-bold italic text-xl tracking-tighter">Kitaly</span>
                        <div class="h-1 w-1 rounded-full bg-italy-600"></div>
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Archive</span>
                    </div>
                    <p class="text-xs text-slate-400">{{ _('Kitaly Shirt Catalogue. Built for collectors.') }}</p>
                    <p class="text-[11px] text-slate-400">
                        {% if session.get('lang', 'en') == 'it' %}
                        Articoli autentici e 100% originali.
                        {% else %}
                        Authentic and 100% Original Items.
                        {% endif %}
                    </p>
                </div>

                {{ contact_action_chips(
                whatsapp_url=('https://wa.me/' ~ whatsapp_number) if whatsapp_number else None,
                instagram_url=('https://instagram.com/' ~ instagram_handle) if instagram_handle else None,
                email_url=('mailto:' ~ official_email) if official_email else None,
                wrapper_class='flex flex-wrap items-center justify-center gap-3'
                ) }}

                <div class="flex items-center gap-6">
                    <span class="text-xs font-medium text-slate-300 uppercase tracking-widest">&copy; 2026</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('main-nav');
            if (nav) {
                if (window.scrollY > 20) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }
            }
        });

    </script>
    <script src="{{ url_for('static', filename='js/theme-manager.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>

</html>
