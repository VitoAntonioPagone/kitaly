{% extends "base.html" %}

{% block title %}{{ _('Catalogue') }} â€” Kitaly Archive{% endblock %}

{% block head %}
<link rel="canonical" href="{{ url_for('public.catalog', _external=True) }}">
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 lg:px-12 py-12">
    <div class="mb-16 animate-slide-up">
        <h1 class="font-display font-bold text-5xl lg:text-6xl tracking-tight text-slate-900 mb-4">
            {{ _('Catalogue') }}<span class="text-italy-600">.</span>
        </h1>
        <p class="text-slate-500 text-lg max-w-2xl leading-relaxed">
            {{ _("Explore our curated collection of iconic football heritage, spanning decades of history and passion.")
            }}
        </p>
    </div>

    <div class="flex flex-col lg:flex-row gap-12">

        <aside class="w-full lg:w-72 flex-shrink-0 animate-slide-up" style="animation-delay: 0.1s">
            <div class="sticky top-32">
                <button id="catalog-filters-toggle" type="button"
                    class="lg:hidden w-full inline-flex items-center justify-between rounded-full border border-slate-200 bg-white/80 px-5 py-3 text-xs font-bold uppercase tracking-widest text-slate-600 shadow-sm">
                    <span id="catalog-filters-toggle-text">{{ _('Show filters') }}</span>
                    <i id="catalog-filters-toggle-icon" data-lucide="chevron-down"
                        class="w-4 h-4 transition-transform duration-200"></i>
                </button>

                <div id="catalog-filters-panel" class="hidden lg:block mt-8 lg:mt-0">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="font-display font-semibold text-xl tracking-tight">{{ _('Filters') }}</h2>
                        <a href="{{ url_for('public.catalog') }}"
                            class="text-[10px] font-bold uppercase tracking-widest text-italy-600 hover:text-italy-700 transition-colors">
                            {{ _('Reset') }}
                        </a>
                    </div>

                    <form action="{{ url_for('public.catalog') }}" method="GET" class="space-y-10">
                        <div class="relative group">
                            <i data-lucide="search"
                                class="absolute left-0 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-italy-600 transition-colors"></i>
                            <input type="text" name="q" value="{{ request.args.get('q', '') }}"
                                placeholder="{{ _('Search...') }}"
                                class="w-full pl-7 py-2 bg-transparent border-b border-slate-200 focus:border-italy-600 outline-none text-sm transition-all">
                        </div>

                        <div class="space-y-8">
                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Brand') }}</label>
                                <select name="brand"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Brands') }}</option>
                                    {% for b in brands %}
                                    <option value="{{ b }}" {% if request.args.get('brand')==b %}selected{% endif %}>{{ b }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Team') }}</label>
                                <select name="squadra"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Teams') }}</option>
                                    {% for sq in squadre %}
                                    <option value="{{ sq }}" {% if request.args.get('squadra')==sq %}selected{% endif %}>{{
                                        sq }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Player') }}</label>
                                <select name="player_name"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Players') }}</option>
                                    {% for pn in player_names %}
                                    <option value="{{ pn }}" {% if request.args.get('player_name')==pn %}selected{% endif %}>
                                        {{ pn }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('League') }}</label>
                                <select name="campionato"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Leagues') }}</option>
                                    {% for league in campionati %}
                                    <option value="{{ league }}" {% if request.args.get('campionato')==league %}selected{%
                                        endif %}>{{ league }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Type') }}</label>
                                <select name="type"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Types') }}</option>
                                    {% for t in types %}
                                    <option value="{{ t }}" {% if request.args.get('type')==t %}selected{% endif %}>{{
                                        t|type_label }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Shirt Feature') }}</label>
                                <select name="tipologia"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Features') }}</option>
                                    {% for t in tipologie %}
                                    <option value="{{ t }}" {% if request.args.get('tipologia')==t %}selected{% endif %}>
                                        {{ t }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Sleeve Type') }}</label>
                                <select name="maniche"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Sleeve Types') }}</option>
                                    {% for m in maniche_values %}
                                    <option value="{{ m }}" {% if request.args.get('maniche')==m %}selected{% endif %}>
                                        {{ m|sleeve_label }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{
                                    _('Season') }}</label>
                                <select name="stagione"
                                    class="w-full py-2 bg-transparent border-b border-slate-200 text-sm focus:border-italy-600 outline-none cursor-pointer"
                                    onchange="this.form.submit()">
                                    <option value="">{{ _('All Seasons') }}</option>
                                    {% for s in stagioni %}
                                    <option value="{{ s }}" {% if request.args.get('stagione')==s %}selected{% endif %}>{{ s
                                        }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </aside>

        <div class="flex-1 animate-slide-up" style="animation-delay: 0.2s">
            <div class="flex justify-between items-center mb-10">
                <p class="text-xs font-medium text-slate-400 italic">
                    {{ shirts|length }} {{ _('items discovered') }}
                </p>
                <form action="{{ url_for('public.catalog') }}" method="GET" class="flex items-center gap-3">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Sort by')
                        }}</span>
                    <select name="sort"
                        class="text-xs font-semibold text-slate-900 bg-transparent outline-none cursor-pointer focus:text-italy-600 transition-colors"
                        onchange="this.form.submit()">
                        <option value="newest" {% if request.args.get('sort')=='newest' %}selected{% endif %}>{{
                            _('Latest Arrival') }}</option>
                        <option value="oldest" {% if request.args.get('sort')=='oldest' %}selected{% endif %}>{{
                            _('Timeline') }}</option>
                    </select>
                    {% for key, value in request.args.items() %}
                    {% if key not in ['sort', 'page'] %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                    {% endfor %}
                </form>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-x-8 gap-y-16">
                {% for shirt in shirts %}
                <a href="{{ url_for('public.shirt_detail', shirt_id=shirt.id, slug=shirt.slug) }}"
                    class="group block">
                    <div
                        class="relative aspect-[4/5] overflow-hidden rounded-[2rem] bg-slate-100 transition-all duration-700 group-hover:shadow-[0_40px_80px_-20px_rgba(0,0,0,0.1)]">
                        {% if shirt.cover_image %}
                        <img src="{{ url_for('uploaded_file', filename=shirt.cover_image.file_path) }}"
                            alt="{{ shirt.squadra }}"
                            class="h-full w-full object-cover transition-transform duration-1000 group-hover:scale-110">
                        {% else %}
                        <div class="flex h-full w-full items-center justify-center text-slate-300">
                            <i data-lucide="shirt" class="w-12 h-12 stroke-[1.5]"></i>
                        </div>
                        {% endif %}

                        <div
                            class="absolute top-6 left-6 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-2 group-hover:translate-y-0">
                            <span
                                class="px-3 py-1.5 bg-white/80 backdrop-blur-md rounded-full text-[10px] font-bold uppercase tracking-widest shadow-sm">
                                {{ shirt.brand }}
                            </span>
                        </div>
                    </div>

                    <div class="mt-8 px-2">
                        <div class="space-y-1">
                            <h3
                                class="font-display font-semibold text-lg tracking-tight text-slate-900 group-hover:text-italy-600 transition-colors leading-snug">
                                {{ shirt|display_name_localized }}
                            </h3>
                            {% if shirt.player_issued %}
                            <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 text-amber-600 text-[10px] font-bold uppercase tracking-widest">
                                {{ _('Player Issue') }}
                                <button type="button" onclick="openPlayerIssueInfoCatalog()"
                                    class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/80 text-amber-600 hover:bg-white transition-colors"
                                    aria-label="{{ _('About Player Issue') }}">
                                    <i data-lucide="info" class="w-3 h-3"></i>
                                </button>
                            </div>
                            {% endif %}
                            <div class="flex items-center gap-3">
                                <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{
                                    shirt.campionato }}</span>
                                <div class="h-1 w-1 rounded-full bg-slate-200"></div>
                                <span class="text-[10px] font-bold uppercase tracking-widest text-italy-600">({{
                                    shirt.taglia }})</span>
                            </div>
                        </div>
                    </div>
                </a>
                {% else %}
                <div
                    class="col-span-full py-32 text-center bg-slate-50 rounded-[3rem] border-2 border-dashed border-slate-100">
                    <div
                        class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-white shadow-sm text-slate-300 mb-8">
                        <i data-lucide="search-x" class="w-10 h-10 stroke-[1]"></i>
                    </div>
                    <h3 class="font-display font-semibold text-2xl text-slate-900 mb-3">{{ _('Nothing matches') }}</h3>
                    <p class="text-slate-400 mb-10">{{ _('Our scouts couldn\'t find any match for your current
                        selection.') }}</p>
                    <a href="{{ url_for('public.catalog') }}"
                        class="inline-flex py-4 px-10 bg-premium-slate text-white rounded-full font-bold text-sm hover:bg-italy-600 transition-all shadow-lg shadow-slate-200/50 active:scale-95">
                        {{ _('Explore All') }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div id="player-issue-info-modal-catalog"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 backdrop-blur-sm px-6">
    <div class="w-full max-w-lg rounded-[2rem] bg-white shadow-2xl border border-slate-100/70 p-8">
        <div class="flex items-start justify-between gap-6 mb-4">
            <h3 class="font-display font-semibold text-xl text-slate-900">{{ _('Player Issue') }}</h3>
            <button type="button" onclick="closePlayerIssueInfoCatalog()"
                class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 transition-colors"
                aria-label="{{ _('Close') }}">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <p class="text-slate-600 leading-relaxed text-sm">
            {{ _('Player Issue (or Staff issue) means an item that was not sold commercially and was produced specifically for the squad, making them one of the rarest and most sought after pieces in the football world!') }}
        </p>
        <div class="mt-6 flex justify-end">
            <button type="button" onclick="closePlayerIssueInfoCatalog()"
                class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl bg-slate-900 text-white text-xs font-bold uppercase tracking-widest hover:bg-italy-600 transition-colors">
                {{ _('Got it') }}
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('catalog-filters-toggle');
        const panel = document.getElementById('catalog-filters-panel');
        const text = document.getElementById('catalog-filters-toggle-text');
        const icon = document.getElementById('catalog-filters-toggle-icon');

        if (!toggle || !panel || !text || !icon) {
            return;
        }

        const showLabel = "{{ _('Show filters') }}";
        const hideLabel = "{{ _('Hide filters') }}";

        const setExpanded = (expanded) => {
            toggle.setAttribute('aria-expanded', String(expanded));
            text.textContent = expanded ? hideLabel : showLabel;
            icon.classList.toggle('rotate-180', expanded);
        };

        setExpanded(false);

        toggle.addEventListener('click', () => {
            const isHidden = panel.classList.contains('hidden');
            if (isHidden) {
                panel.classList.remove('hidden');
                setExpanded(true);
            } else {
                panel.classList.add('hidden');
                setExpanded(false);
            }
        });
    });

    function openPlayerIssueInfoCatalog() {
        const modal = document.getElementById('player-issue-info-modal-catalog');
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
    }
    function closePlayerIssueInfoCatalog() {
        const modal = document.getElementById('player-issue-info-modal-catalog');
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }
</script>
{% endblock %}
