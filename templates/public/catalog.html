{% extends "base.html" %}

{% block title %}{{ _('Catalogue') }}{% if request.args.get('brand') %} — {{ request.args.get('brand') }}{% endif %} —
Kitaly Archive{% endblock %}

{% block head %}
<link rel="canonical" href="{{ url_for('public.catalog', _external=True) }}">
<style>
    .catalog-filter-group summary::-webkit-details-marker {
        display: none;
    }

    .catalog-filter-group[open] .catalog-filter-summary-icon {
        transform: rotate(180deg);
    }

    html.dark .catalog-filter-group {
        border-color: rgba(51, 65, 85, 0.92);
        background: rgba(15, 23, 42, 0.85);
        box-shadow: 0 14px 32px -26px rgba(2, 6, 23, 0.8);
    }

    html.dark .catalog-filter-group>div {
        border-top-color: rgba(30, 41, 59, 0.95);
    }

    html.dark .catalog-filter-summary-icon {
        color: #64748b;
    }

    .catalog-filter-summary {
        cursor: pointer;
        transition: background-color 180ms ease, color 180ms ease;
    }

    .catalog-filter-summary:hover {
        background-color: rgba(248, 250, 252, 0.95);
    }

    html.dark .catalog-filter-summary {
        color: #e2e8f0;
    }

    html.dark .catalog-filter-summary:hover {
        background-color: rgba(30, 41, 59, 0.92);
    }

    .catalog-filter-option {
        min-height: 2.75rem;
        border: 1px solid #dbe3ec;
        border-radius: 9999px;
        background: #fff;
        color: #334155;
        cursor: pointer;
        line-height: 1.2;
        white-space: normal;
        transition: background-color 180ms ease, border-color 180ms ease, color 180ms ease, box-shadow 180ms ease;
    }

    .catalog-filter-option:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
    }

    html.dark .catalog-filter-option {
        border-color: rgba(148, 163, 184, 0.28);
        background: rgba(15, 23, 42, 0.88);
        color: #e2e8f0;
    }

    html.dark .catalog-filter-option:hover {
        background: rgba(30, 41, 59, 0.95);
        border-color: rgba(148, 163, 184, 0.42);
    }

    .catalog-filter-option[aria-pressed="true"] {
        background: #0f172a;
        border-color: #0f172a;
        color: #fff;
        box-shadow: 0 10px 24px -18px rgba(15, 23, 42, 0.85);
    }

    html.dark .catalog-filter-option[aria-pressed="true"] {
        background: #0055a4;
        border-color: #0055a4;
        color: #f8fafc;
        box-shadow: 0 12px 28px -20px rgba(0, 85, 164, 0.95);
    }

    .catalog-filter-option:focus-visible,
    .catalog-filter-summary:focus-visible {
        outline: 2px solid #0055a4;
        outline-offset: 2px;
    }

    .catalog-filter-action {
        transition: background-color 180ms ease, border-color 180ms ease, color 180ms ease, box-shadow 180ms ease, opacity 180ms ease;
    }

    .catalog-filter-action:focus-visible {
        outline: 2px solid #0055a4;
        outline-offset: 2px;
    }

    .catalog-filter-action:disabled {
        cursor: not-allowed;
        opacity: 0.45;
        box-shadow: none;
    }

    html.dark .catalog-filter-secondary {
        border-color: rgba(148, 163, 184, 0.24);
        background: rgba(15, 23, 42, 0.9);
        color: #cbd5e1;
    }

    html.dark .catalog-filter-secondary:hover {
        border-color: rgba(148, 163, 184, 0.4);
        background: rgba(30, 41, 59, 0.96);
        color: #f8fafc;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 lg:px-12 py-12">
    <div class="mb-16 animate-slide-up">
        <h1 class="font-display font-bold text-5xl lg:text-6xl tracking-tight text-slate-900 mb-4">
            {{ _('Catalogue') }}<span class="text-italy-600">.</span>
        </h1>
        <div class="w-full mb-6">
            <div
                class="inline-flex max-w-full items-center gap-3 rounded-2xl border border-stone-200 bg-stone-50/70 px-4 sm:px-5 py-2.5 sm:py-3 dark:border-slate-700 dark:bg-slate-800/75">
                <p
                    class="text-sm sm:text-[0.95rem] font-medium italic tracking-[0.03em] text-stone-700 leading-snug dark:text-slate-200">
                    {% if session.get('lang', 'en') == 'it' %}
                    Articoli Autentici E <span class="font-semibold text-stone-900 dark:text-slate-100">100%</span>
                    Originali
                    {% else %}
                    Authenicity Guaranteed. Originals Pieces Only
                    {% endif %}
                </p>
                <span
                    class="inline-flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full border border-stone-300/90 bg-white/80 text-stone-600 dark:border-slate-600 dark:bg-slate-900/70 dark:text-slate-200">
                    <svg class="h-4 w-4" viewBox="0 0 512 512" fill="currentColor" aria-hidden="true">
                        <path
                            d="M425.706,86.294A240,240,0,0,0,86.294,425.706,240,240,0,0,0,425.706,86.294Zm-4.464,43.535A206.875,206.875,0,0,1,463.824,247.8l-66.14-49.772ZM316.033,56.845l-58.378,43.37L196.53,56.677a208.143,208.143,0,0,1,119.5.168ZM116.8,198.047,48.156,248.33A206.9,206.9,0,0,1,91.248,129.189ZM86.2,376h79.365L190.6,453.458A208.923,208.923,0,0,1,86.2,376Zm140.787,85.967L188.85,344H67.562a206.3,206.3,0,0,1-17.324-57.527l104.967-76.9L115.557,102.715a208.938,208.938,0,0,1,45.714-31.864l96.781,68.934,92.741-68.9a208.922,208.922,0,0,1,45.884,32.048L359.833,209.6l101.951,76.721A206.272,206.272,0,0,1,444.438,344H327.512L285.467,461.9a208.076,208.076,0,0,1-58.482.064Zm95.606-8.9L350.075,376H425.8A208.961,208.961,0,0,1,322.591,453.069Z" />
                        <path
                            d="M346.809,223.427,257.854,158.8,168.9,223.427,202.876,328H312.831ZM289.582,296H226.125l-19.609-60.351,51.338-37.3,51.337,37.3Z" />
                    </svg>
                </span>
            </div>
        </div>
        <p class="text-slate-500 text-lg max-w-2xl leading-relaxed">
            {{ _("Explore our curated collection of iconic football heritage, spanning decades of history and passion.")
            }}
        </p>
    </div>

    <div class="flex flex-col lg:flex-row gap-12 lg:items-start">

        <aside class="w-full lg:w-80 flex-shrink-0 animate-slide-up" style="animation-delay: 0.1s">
            <div class="sticky top-28">
                <button id="catalog-filters-toggle" type="button"
                    class="lg:hidden w-full inline-flex items-center justify-between rounded-full border border-slate-200 bg-white/80 px-5 py-3 text-xs font-bold uppercase tracking-widest text-slate-600 shadow-sm dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-200">
                    <span id="catalog-filters-toggle-text">{{ _('Show filters') }}</span>
                    <i id="catalog-filters-toggle-icon" data-lucide="chevron-down"
                        class="w-4 h-4 transition-transform duration-200"></i>
                </button>

                <div id="catalog-filters-panel"
                    class="hidden lg:block mt-8 lg:mt-0 lg:max-h-[calc(100vh-9rem)] lg:overflow-y-auto lg:pr-3">
                    <div class="mb-8">
                        <h2
                            class="font-display font-semibold text-xl tracking-tight text-slate-900 dark:text-slate-100">
                            {{ _('Filters') }}</h2>
                    </div>

                    <form action="{{ url_for('public.catalog') }}" method="GET" class="space-y-8" data-filter-form>
                        {% set selected_brands = request.args.getlist('brand') %}
                        {% set selected_teams = request.args.getlist('squadra') %}
                        {% set selected_players = request.args.getlist('player_name') %}
                        {% set selected_leagues = request.args.getlist('campionato') %}
                        {% set selected_types = request.args.getlist('type') %}
                        {% set selected_features = request.args.getlist('tipologia') %}
                        {% set selected_sleeves = request.args.getlist('maniche') %}
                        {% set selected_seasons = request.args.getlist('stagione') %}
                        {% set selected_sizes = request.args.getlist('taglia') %}
                        <div class="relative group">
                            <i data-lucide="search"
                                class="absolute left-0 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-italy-600 transition-colors"></i>
                            <input type="text" name="q" value="{{ request.args.get('q', '') }}"
                                placeholder="{{ _('Search...') }}"
                                class="w-full pl-7 py-2 bg-transparent border-b border-slate-200 focus:border-italy-600 outline-none text-sm transition-all">
                        </div>

                        <div class="flex flex-col gap-3 sm:flex-row sm:items-center" data-filter-actions>
                            <button type="submit"
                                class="catalog-filter-action inline-flex w-full items-center justify-center rounded-full bg-slate-900 px-5 py-3 text-[10px] font-bold uppercase tracking-widest text-white shadow-sm hover:bg-italy-600 focus-visible:bg-italy-600 sm:flex-1"
                                data-apply-filters aria-label="{{ _('Apply filters') }}">
                                {{ _('Apply') }}
                            </button>
                            <button type="button"
                                class="catalog-filter-action catalog-filter-secondary inline-flex w-full items-center justify-center rounded-full border border-slate-200 bg-white px-5 py-3 text-[10px] font-bold uppercase tracking-widest text-slate-600 hover:border-slate-300 hover:bg-slate-50 focus-visible:border-italy-600 focus-visible:text-italy-600 sm:w-auto"
                                data-reset-filters aria-label="{{ _('Reset filters') }}">
                                {{ _('Reset') }}
                            </button>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)] dark:border-slate-700 dark:bg-slate-900/85 dark:shadow-[0_14px_32px_-26px_rgba(2,6,23,0.8)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Brand') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200 dark:text-slate-500"></i>
                                    </summary>
                                    <div
                                        class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4 dark:border-slate-800">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for b in brands %}
                                            <input id="filter-brand-{{ loop.index }}" type="checkbox" name="brand"
                                                value="{{ b }}" class="sr-only" {% if b in selected_brands %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-brand-{{ loop.index }}"
                                                aria-pressed="{% if b in selected_brands %}true{% else %}false{% endif %}">
                                                {{ b }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)] dark:border-slate-700 dark:bg-slate-900/85 dark:shadow-[0_14px_32px_-26px_rgba(2,6,23,0.8)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Team') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200 dark:text-slate-500"></i>
                                    </summary>
                                    <div
                                        class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4 dark:border-slate-800">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for team in squadre %}
                                            <input id="filter-team-{{ loop.index }}" type="checkbox" name="squadra"
                                                value="{{ team.value }}" class="sr-only" {% if team.value in
                                                selected_teams %}checked{% endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-team-{{ loop.index }}"
                                                aria-pressed="{% if team.value in selected_teams %}true{% else %}false{% endif %}">
                                                {{ team.label }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>
                            <div>
                                <div class="flex flex-wrap gap-2.5">
                                    <input id="filter-national-team" type="checkbox" name="nazionale" value="1"
                                        class="sr-only" {% if request.args.get('nazionale') %}checked{% endif %}>
                                    <button type="button"
                                        class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                        data-filter-toggle data-filter-target="filter-national-team"
                                        aria-pressed="{% if request.args.get('nazionale') %}true{% else %}false{% endif %}">
                                        {{ _('National Team') }}
                                    </button>
                                </div>
                            </div>

                            <div>
                                <div class="flex flex-wrap gap-2.5">
                                    <input id="filter-player-issued" type="checkbox" name="player_issued" value="1"
                                        class="sr-only" {% if request.args.get('player_issued') %}checked{% endif %}>
                                    <button type="button"
                                        class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                        data-filter-toggle data-filter-target="filter-player-issued"
                                        aria-pressed="{% if request.args.get('player_issued') %}true{% else %}false{% endif %}">
                                        {{ _('Player Issue') }}
                                    </button>
                                </div>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Player') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for pn in player_names %}
                                            <input id="filter-player-{{ loop.index }}" type="checkbox"
                                                name="player_name" value="{{ pn }}" class="sr-only" {% if pn in
                                                selected_players %}checked{% endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-player-{{ loop.index }}"
                                                aria-pressed="{% if pn in selected_players %}true{% else %}false{% endif %}">
                                                {{ pn }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('League') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for league in campionati %}
                                            <input id="filter-league-{{ loop.index }}" type="checkbox" name="campionato"
                                                value="{{ league }}" class="sr-only" {% if league in selected_leagues
                                                %}checked{% endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-league-{{ loop.index }}"
                                                aria-pressed="{% if league in selected_leagues %}true{% else %}false{% endif %}">
                                                {{ league }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Type') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for t in types %}
                                            <input id="filter-type-{{ loop.index }}" type="checkbox" name="type"
                                                value="{{ t }}" class="sr-only" {% if t in selected_types %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-type-{{ loop.index }}"
                                                aria-pressed="{% if t in selected_types %}true{% else %}false{% endif %}">
                                                {{ t|type_label }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Shirt Feature') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for t in tipologie %}
                                            <input id="filter-feature-{{ loop.index }}" type="checkbox" name="tipologia"
                                                value="{{ t }}" class="sr-only" {% if t in selected_features %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-feature-{{ loop.index }}"
                                                aria-pressed="{% if t in selected_features %}true{% else %}false{% endif %}">
                                                {{ t|feature_label }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Sleeve Type') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for m in maniche_values %}
                                            <input id="filter-sleeve-{{ loop.index }}" type="checkbox" name="maniche"
                                                value="{{ m }}" class="sr-only" {% if m in selected_sleeves %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-sleeve-{{ loop.index }}"
                                                aria-pressed="{% if m in selected_sleeves %}true{% else %}false{% endif %}">
                                                {{ m|sleeve_label }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Season') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for s in stagioni %}
                                            <input id="filter-season-{{ loop.index }}" type="checkbox" name="stagione"
                                                value="{{ s }}" class="sr-only" {% if s in selected_seasons %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-season-{{ loop.index }}"
                                                aria-pressed="{% if s in selected_seasons %}true{% else %}false{% endif %}">
                                                {{ s }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>

                            <div>
                                <details
                                    class="catalog-filter-group rounded-2xl border border-slate-200 bg-white/90 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.35)]">
                                    <summary
                                        class="catalog-filter-summary flex list-none items-center justify-between gap-3 rounded-2xl px-4 py-3 text-sm font-medium text-slate-700">
                                        <span>{{ _('Size') }}</span>
                                        <i data-lucide="chevron-down"
                                            class="catalog-filter-summary-icon h-4 w-4 text-slate-400 transition-transform duration-200"></i>
                                    </summary>
                                    <div class="max-h-52 overflow-y-auto border-t border-slate-100 px-4 py-4">
                                        <div class="flex flex-wrap gap-2.5">
                                            {% for t in taglie %}
                                            <input id="filter-size-{{ loop.index }}" type="checkbox" name="taglia"
                                                value="{{ t }}" class="sr-only" {% if t in selected_sizes %}checked{%
                                                endif %}>
                                            <button type="button"
                                                class="catalog-filter-option inline-flex items-center justify-center px-4 py-2 text-sm font-medium"
                                                data-filter-toggle data-filter-target="filter-size-{{ loop.index }}"
                                                aria-pressed="{% if t in selected_sizes %}true{% else %}false{% endif %}">
                                                {{ t }}
                                            </button>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </details>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </aside>

        <div class="flex-1 animate-slide-up" style="animation-delay: 0.2s">
            <div class="flex justify-between items-center mb-10">
                <p class="text-xs font-medium text-slate-400 italic">
                    {{ shirts.total }} {{ _('items discovered') }}
                </p>
                <form action="{{ url_for('public.catalog') }}" method="GET" class="flex items-center gap-3">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Sort by')
                        }}</span>
                    <select name="sort"
                        class="text-xs font-semibold text-slate-900 bg-transparent outline-none cursor-pointer focus:text-italy-600 transition-colors"
                        onchange="this.form.submit()">
                        <option value="newest" {% if request.args.get('sort', 'random' )=='newest' %}selected{% endif
                            %}>{{
                            _('Latest Arrival') }}</option>
                        <option value="oldest" {% if request.args.get('sort')=='oldest' %}selected{% endif %}>{{
                            _('Timeline') }}</option>
                        <option value="random" {% if request.args.get('sort', 'random' )=='random' %}selected{% endif
                            %}>{{
                            _('Random') }}</option>
                    </select>
                    {% for key, values in request.args.lists() %}
                    {% if key not in ['sort', 'page', 'seed'] %}
                    {% for value in values %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                    {% if request.args.get('sort', 'random') == 'random' and shuffle_seed %}
                    <input type="hidden" name="seed" value="{{ shuffle_seed }}">
                    {% endif %}
                </form>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-2 xl:grid-cols-3 gap-x-4 sm:gap-x-8 gap-y-10 sm:gap-y-16">
                {% for shirt in shirts.items %}
                <a href="{{ url_for('public.shirt_detail', shirt_id=shirt.id, slug=shirt|shirt_slug_localized) }}"
                    class="group block">
                    <div
                        class="relative aspect-[4/5] overflow-hidden rounded-[2rem] bg-slate-100 transition-all duration-700 group-hover:shadow-[0_40px_80px_-20px_rgba(0,0,0,0.1)]">
                        {% if shirt.images %}
                        {% set active_image_id = shirt.images[0].id %}
                        <div class="h-full w-full relative" data-gallery style="touch-action: pan-y;">
                            {% for img in shirt.images %}
                            <img src="{{ url_for('uploaded_file', filename=img.file_path) }}"
                                alt="{{ shirt|team_name_localized }}" data-gallery-image
                                class="absolute inset-0 h-full w-full object-cover transition-[opacity,transform] duration-200 ease-out group-hover:scale-110 {% if img.id != active_image_id %}opacity-0 pointer-events-none{% else %}opacity-100{% endif %}">
                            {% endfor %}
                            {% if shirt.images|length > 1 %}
                            <div
                                class="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-2 py-1 rounded-full bg-black/15 backdrop-blur-sm pointer-events-none">
                                {% for img in shirt.images %}
                                <span data-gallery-dot
                                    class="h-1.5 w-1.5 rounded-full {% if img.id == active_image_id %}bg-white{% else %}bg-white/40{% endif %}"></span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="flex h-full w-full items-center justify-center text-slate-300">
                            <i data-lucide="shirt" class="w-12 h-12 stroke-[1.5]"></i>
                        </div>
                        {% endif %}
                    </div>

                    <div class="mt-8 px-2">
                        <div class="space-y-1">
                            <h3
                                class="font-display font-semibold text-lg tracking-tight text-slate-900 group-hover:text-italy-600 transition-colors leading-snug">
                                {{ shirt|display_name_localized }}
                                {% if shirt.player_issued %}
                                <span class="inline-flex align-middle ml-1 text-amber-500"
                                    aria-label="{{ _('Player Issue') }}">
                                    <i data-lucide="star"
                                        class="w-3 h-3 fill-current player-issue-star player-issue-star-title"></i>
                                </span>
                                {% endif %}
                            </h3>
                            {% if shirt.player_issued %}
                            <div
                                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 text-amber-600 text-[10px] font-bold uppercase tracking-widest">
                                <i data-lucide="star" class="w-3 h-3 fill-current"></i>
                                {{ _('Player Issue') }}
                                <button type="button" onclick="openPlayerIssueInfoCatalog()"
                                    class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/80 text-amber-600 hover:bg-white transition-colors"
                                    aria-label="{{ _('About Player Issue') }}">
                                    <i data-lucide="info" class="w-3 h-3"></i>
                                </button>
                            </div>
                            {% endif %}
                            <div class="flex items-center gap-3">
                                <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{
                                    shirt|competition_label_localized }}</span>
                                <div class="h-1 w-1 rounded-full bg-slate-200"></div>
                                <span class="text-[10px] font-bold uppercase tracking-widest text-italy-600">({{
                                    shirt.taglia }})</span>
                            </div>
                        </div>
                    </div>
                </a>
                {% else %}
                <div
                    class="col-span-full py-32 text-center bg-slate-50 rounded-[3rem] border-2 border-dashed border-slate-100">
                    <div
                        class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-white shadow-sm text-slate-300 mb-8">
                        <i data-lucide="search-x" class="w-10 h-10 stroke-[1]"></i>
                    </div>
                    <h3 class="font-display font-semibold text-2xl text-slate-900 mb-3">{{ _('Nothing matches') }}</h3>
                    <p class="text-slate-400 mb-10">{{ _('Our scouts couldn\'t find any match for your current
                        selection.') }}</p>
                    <a href="{{ url_for('public.catalog') }}"
                        class="inline-flex py-4 px-10 bg-premium-slate text-white rounded-full font-bold text-sm hover:bg-italy-600 transition-all shadow-lg shadow-slate-200/50 active:scale-95">
                        {{ _('Explore All') }}
                    </a>
                </div>
                {% endfor %}
            </div>

            {% if shirts.pages > 1 %}
            <nav class="mt-14 flex items-center justify-center gap-3" aria-label="Pagination">
                {% if shirts.has_prev %}
                <a href="{{ catalog_url_for(page=shirts.prev_num) }}"
                    class="inline-flex items-center justify-center rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600 hover:border-italy-100 hover:text-italy-600 transition-colors">
                    {{ _('Previous') }}
                </a>
                {% endif %}

                <span class="text-xs font-semibold text-slate-400">
                    {{ _('Page') }} {{ shirts.page }} / {{ shirts.pages }}
                </span>

                {% if shirts.has_next %}
                <a href="{{ catalog_url_for(page=shirts.next_num) }}"
                    class="inline-flex items-center justify-center rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600 hover:border-italy-100 hover:text-italy-600 transition-colors">
                    {{ _('Next') }}
                </a>
                {% endif %}
            </nav>
            {% endif %}
        </div>
    </div>
</div>

<div id="player-issue-info-modal-catalog"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 backdrop-blur-sm px-6">
    <div class="w-full max-w-lg rounded-[2rem] bg-white shadow-2xl border border-slate-100/70 p-8">
        <div class="flex items-start justify-between gap-6 mb-4">
            <h3 class="font-display font-semibold text-xl text-slate-900">{{ _('Player Issue') }}</h3>
            <button type="button" onclick="closePlayerIssueInfoCatalog()"
                class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 transition-colors"
                aria-label="{{ _('Close') }}">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <p class="text-slate-600 leading-relaxed text-sm">
            {{ _('Player Issue (or Staff issue) means an item that was not sold commercially and was produced
            specifically for the squad, making them one of the rarest and most sought after pieces in the football
            world!') }}
        </p>
        <div class="mt-6 flex justify-end">
            <button type="button" onclick="closePlayerIssueInfoCatalog()"
                class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl bg-slate-900 text-white text-xs font-bold uppercase tracking-widest hover:bg-italy-600 transition-colors">
                {{ _('Got it') }}
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('catalog-filters-toggle');
        const panel = document.getElementById('catalog-filters-panel');
        const text = document.getElementById('catalog-filters-toggle-text');
        const icon = document.getElementById('catalog-filters-toggle-icon');

        if (toggle && panel && text && icon) {
            const showLabel = "{{ _('Show filters') }}";
            const hideLabel = "{{ _('Hide filters') }}";

            const setExpanded = (expanded) => {
                toggle.setAttribute('aria-expanded', String(expanded));
                text.textContent = expanded ? hideLabel : showLabel;
                icon.classList.toggle('rotate-180', expanded);
            };

            setExpanded(false);

            toggle.addEventListener('click', () => {
                const isHidden = panel.classList.contains('hidden');
                if (isHidden) {
                    panel.classList.remove('hidden');
                    setExpanded(true);
                } else {
                    panel.classList.add('hidden');
                    setExpanded(false);
                }
            });
        }

        const filterForm = document.querySelector('[data-filter-form]');

        if (filterForm) {
            const applyButton = filterForm.querySelector('[data-apply-filters]');
            const resetButton = filterForm.querySelector('[data-reset-filters]');
            const trackedInputs = Array.from(filterForm.querySelectorAll('input[name]')).filter((input) => (
                input.type === 'checkbox' || input.type === 'text'
            ));
            const toggleButtons = Array.from(filterForm.querySelectorAll('[data-filter-toggle]'));

            const initialState = new Map(trackedInputs.map((input) => {
                const value = input.type === 'checkbox' ? input.checked : input.value;
                return [input, value];
            }));

            const syncToggleButton = (button) => {
                const input = document.getElementById(button.dataset.filterTarget);
                if (!input) {
                    return;
                }
                button.setAttribute('aria-pressed', input.checked ? 'true' : 'false');
            };

            const updateActionState = () => {
                const hasSelectedFilters = trackedInputs.some((input) => (
                    input.type === 'checkbox' ? input.checked : input.value.trim() !== ''
                ));
                const hasChanges = trackedInputs.some((input) => {
                    const currentValue = input.type === 'checkbox' ? input.checked : input.value;
                    return currentValue !== initialState.get(input);
                });

                if (applyButton) {
                    applyButton.disabled = !hasChanges;
                    applyButton.setAttribute('aria-disabled', applyButton.disabled ? 'true' : 'false');
                }

                if (resetButton) {
                    resetButton.disabled = !hasSelectedFilters;
                    resetButton.setAttribute('aria-disabled', resetButton.disabled ? 'true' : 'false');
                }
            };

            toggleButtons.forEach((button) => {
                const input = document.getElementById(button.dataset.filterTarget);
                if (!input) {
                    return;
                }

                syncToggleButton(button);
                button.addEventListener('click', () => {
                    input.checked = !input.checked;
                    syncToggleButton(button);
                    updateActionState();
                });
                input.addEventListener('change', () => {
                    syncToggleButton(button);
                    updateActionState();
                });
            });

            trackedInputs.forEach((input) => {
                if (input.type !== 'checkbox') {
                    input.addEventListener('input', updateActionState);
                    input.addEventListener('change', updateActionState);
                }
            });

            if (resetButton) {
                resetButton.addEventListener('click', () => {
                    trackedInputs.forEach((input) => {
                        if (input.type === 'checkbox') {
                            input.checked = false;
                        } else {
                            input.value = '';
                        }
                    });
                    toggleButtons.forEach(syncToggleButton);
                    updateActionState();
                });
            }

            updateActionState();
        }

        document.querySelectorAll('[data-gallery]').forEach((gallery) => {
            const images = Array.from(gallery.querySelectorAll('[data-gallery-image]'));
            if (images.length < 2) {
                return;
            }

            const dots = Array.from(gallery.querySelectorAll('[data-gallery-dot]'));
            const initialIndex = 0;
            let currentIndex = initialIndex;
            let firstHoverTimer = null;
            let resetTimer = null;
            let isHovering = false;

            const setSlide = (nextIndex) => {
                currentIndex = (nextIndex + images.length) % images.length;
                images.forEach((img, index) => {
                    img.classList.toggle('opacity-100', index === currentIndex);
                    img.classList.toggle('opacity-0', index !== currentIndex);
                    img.classList.toggle('pointer-events-none', index !== currentIndex);
                });
                dots.forEach((dot, index) => {
                    dot.classList.toggle('bg-white', index === currentIndex);
                    dot.classList.toggle('bg-white/40', index !== currentIndex);
                });
            };
            setSlide(initialIndex);

            const hasHoverPointer = window.matchMedia('(hover: hover) and (pointer: fine)').matches;
            const clearHoverTimers = () => {
                if (firstHoverTimer) {
                    clearTimeout(firstHoverTimer);
                    firstHoverTimer = null;
                }
                if (resetTimer) {
                    clearTimeout(resetTimer);
                    resetTimer = null;
                }
            };

            const showHoverPreview = () => {
                if (!hasHoverPointer || images.length < 2) {
                    return;
                }
                isHovering = true;
                clearHoverTimers();

                firstHoverTimer = setTimeout(() => {
                    if (!isHovering) {
                        return;
                    }
                    setSlide(1);

                    resetTimer = setTimeout(() => {
                        if (!isHovering) {
                            return;
                        }
                        setSlide(initialIndex);
                    }, 1250);
                }, 900);
            };

            const showInitialSlide = () => {
                isHovering = false;
                clearHoverTimers();
                setSlide(initialIndex);
            };

            gallery.addEventListener('mouseenter', showHoverPreview);
            gallery.addEventListener('mouseleave', showInitialSlide);

            let touchStartX = 0;
            let touchStartY = 0;
            let touchDeltaX = 0;
            let touchDeltaY = 0;

            gallery.addEventListener('touchstart', (event) => {
                if (!event.touches.length) {
                    return;
                }
                touchStartX = event.touches[0].clientX;
                touchStartY = event.touches[0].clientY;
                touchDeltaX = 0;
                touchDeltaY = 0;
            }, { passive: true });

            gallery.addEventListener('touchmove', (event) => {
                if (!event.touches.length) {
                    return;
                }
                touchDeltaX = event.touches[0].clientX - touchStartX;
                touchDeltaY = event.touches[0].clientY - touchStartY;
            }, { passive: true });

            gallery.addEventListener('touchend', () => {
                // Keep vertical page scrolling natural; switch image only on clear horizontal swipe.
                if (Math.abs(touchDeltaX) < 36 || Math.abs(touchDeltaX) <= Math.abs(touchDeltaY)) {
                    touchDeltaX = 0;
                    touchDeltaY = 0;
                    return;
                }

                if (touchDeltaX < 0) {
                    setSlide(currentIndex + 1);
                } else {
                    setSlide(currentIndex - 1);
                }

                touchDeltaX = 0;
                touchDeltaY = 0;
            });
        });
    });

    function openPlayerIssueInfoCatalog() {
        const modal = document.getElementById('player-issue-info-modal-catalog');
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
    }
    function closePlayerIssueInfoCatalog() {
        const modal = document.getElementById('player-issue-info-modal-catalog');
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }
</script>
{% endblock %}