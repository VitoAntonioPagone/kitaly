{% extends "base.html" %}

{% block title %}{{ [shirt.stagione, shirt|team_name_localized, shirt.brand, shirt.tipologia|feature_label, shirt.type|type_label_or_shirt]|select|join(' ') }} - ({{ shirt.taglia }}) — Kitaly Archive{% endblock %}

{% block head %}
<link rel="canonical" href="{{ url_for('public.shirt_detail', shirt_id=shirt.id, slug=shirt|shirt_slug_localized, _external=True) }}">
<meta name="description"
    content="Kitaly Archive: {{ [shirt.stagione, shirt|team_name_localized, shirt.tipologia|feature_label]|select|join(' ') }} {{ shirt.type|type_label_or_shirt }}. {{ shirt.brand }} edition, size {{ shirt.taglia }}. {{ display_description|default('')|truncate(150) }}">
<meta name="keywords"
    content="{{ shirt|team_name_localized }}, {{ shirt.stagione }}, {{ shirt.brand }}, {{ shirt.campionato }}, football heritage, soccer jersey, {{ shirt.tipologia|feature_label }}, {{ shirt.taglia }}, kitaly archive">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:title"
    content="{{ [shirt.stagione, shirt|team_name_localized, shirt.brand, shirt.tipologia|feature_label, shirt.type|type_label_or_shirt]|select|join(' ') }} - ({{ shirt.taglia }}) — Kitaly Archive">
<meta property="og:description"
    content="Discover this {{ shirt.brand }} {{ shirt.type|type_label_or_shirt }} from {{ shirt.stagione }}. Part of the Kitaly football heritage collection.">
{% if shirt.cover_image %}
<meta property="og:image"
    content="{{ url_for('uploaded_file', filename=shirt.cover_image.file_path, _external=True) }}">
{% endif %}

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title"
    content="{{ [shirt.stagione, shirt|team_name_localized, shirt.brand, shirt.tipologia|feature_label, shirt.type|type_label_or_shirt]|select|join(' ') }} - ({{ shirt.taglia }}) — Kitaly Archive">
<meta property="twitter:description"
    content="Discover this {{ shirt.brand }} {{ shirt.type|type_label_or_shirt }} from {{ shirt.stagione }}. Part of the Kitaly football heritage collection.">
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 lg:px-12 py-12">
    <nav
        class="flex flex-wrap items-center gap-x-3 gap-y-2 text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-12 animate-slide-up">
        <a href="{{ url_for('public.catalog') }}" class="hover:text-italy-600 transition-colors">{{ _('Home') }}</a>
        <div class="h-1 w-1 rounded-full bg-slate-200"></div>
        <a href="{{ url_for('public.catalog', nazionale=1 if shirt.nazionale else 0) }}"
            class="hover:text-italy-600 transition-colors">
            {% if shirt.nazionale %}
            {{ _('National Team') }}
            {% else %}
            {{ _('Italian Clubs') if shirt.campionato == 'Serie A' else _('Clubs') }}
            {% endif %}
        </a>
        {% set campionato_key = (shirt.campionato or '')|lower %}
        {% if not (shirt.nazionale and campionato_key in ['nazionali', 'national teams', 'national team']) %}
        <div class="h-1 w-1 rounded-full bg-slate-200"></div>
        <a href="{{ url_for('public.catalog', campionato=shirt.campionato) }}"
            class="hover:text-italy-600 transition-colors">{{ shirt.campionato }}</a>
        {% endif %}
        <div class="h-1 w-1 rounded-full bg-slate-200"></div>
        <a href="{{ url_for('public.catalog', q=shirt.squadra) }}" class="hover:text-italy-600 transition-colors">{{
            shirt|team_name_localized }}</a>
        <div class="h-1 w-1 rounded-full bg-slate-200"></div>
        <a href="{{ url_for('public.shirt_detail', shirt_id=shirt.id, slug=shirt|shirt_slug_localized) }}"
            class="text-slate-900 italic break-words hover:text-italy-600 transition-colors">
            {{ shirt|display_name_localized }}
            {% if shirt.player_issued %}
            <span class="inline-flex align-middle ml-1 text-amber-500" aria-label="{{ _('Player Issue') }}">
                <i data-lucide="star" class="w-3 h-3 fill-current player-issue-star player-issue-star-title"></i>
            </span>
            {% endif %}
        </a>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-16 lg:gap-24">
        <div class="lg:col-span-7 space-y-8 animate-slide-up" style="animation-delay: 0.1s">
            <div
                class="relative aspect-[4/5] rounded-[3rem] overflow-hidden bg-slate-50 shadow-2xl shadow-slate-200/50 group">
                {% if shirt.images %}
                <img id="main-image"
                    src="{{ url_for('uploaded_file', filename=shirt.cover_image.file_path if shirt.cover_image else shirt.images[0].file_path) }}"
                    alt="{{ shirt|team_name_localized }}"
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                {% else %}
                <div class="flex h-full w-full items-center justify-center text-slate-200">
                    <i data-lucide="shirt" class="w-32 h-32 stroke-[1]"></i>
                </div>
                {% endif %}

                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/5 pointer-events-none"></div>
            </div>

            {% if shirt.images|length > 1 %}
            <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide">
                {% for img in shirt.images %}
                <button onclick="changeMainImage('{{ url_for('uploaded_file', filename=img.file_path) }}', this)"
                    class="thumbnail-btn flex-shrink-0 w-24 aspect-[4/5] rounded-2xl overflow-hidden border-2 transition-all duration-300 {{ 'border-italy-600 ring-2 ring-italy-100' if (shirt.cover_image and img.id == shirt.cover_image.id) or (not shirt.cover_image and loop.first) else 'border-transparent opacity-60 hover:opacity-100' }}">
                    <img src="{{ url_for('uploaded_file', filename=img.file_path) }}"
                        class="w-full h-full object-cover">
                </button>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="lg:col-span-5 flex flex-col animate-slide-up" style="animation-delay: 0.2s">
            <header class="mb-12">
                <div class="flex items-center gap-4 mb-4">
                    <span
                        class="px-3 py-1 bg-italy-50 text-italy-600 text-[10px] font-bold uppercase tracking-widest rounded-full">
                        {{ shirt.brand }}
                    </span>
                    {% if shirt.player_issued %}
                    <span
                        class="px-3 py-1 bg-amber-50 text-amber-600 text-[10px] font-bold uppercase tracking-widest rounded-full flex items-center gap-1.5">
                        <i data-lucide="star" class="w-3 h-3 fill-current"></i> {{ _('Player Issue') }}
                        <button type="button" onclick="openPlayerIssueInfo()"
                            class="ml-1 inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/80 text-amber-600 hover:bg-white transition-colors"
                            aria-label="{{ _('About Player Issue') }}">
                            <i data-lucide="info" class="w-3 h-3"></i>
                        </button>
                    </span>
                    {% endif %}
                </div>

                <h1
                    class="font-display font-bold text-4xl lg:text-5xl tracking-tight text-slate-900 mb-4 leading-tight">
                    {{ shirt|display_name_localized }}
                    {% if shirt.player_issued %}
                    <span class="inline-flex align-middle ml-1 text-amber-500" aria-label="{{ _('Player Issue') }}">
                        <i data-lucide="star" class="w-3 h-3 fill-current player-issue-star player-issue-star-title"></i>
                    </span>
                    {% endif %}
                </h1>
            </header>

            <div class="grid grid-cols-2 gap-y-10 gap-x-12 mb-16">
                <div class="space-y-1">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Competition') }}</p>
                    <p class="font-medium text-slate-900">{{ shirt|competition_label_localized }}</p>
                </div>
                {% if shirt.type %}
                <div class="space-y-1">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Type') }}</p>
                    <p class="font-medium text-slate-900">{{ shirt.type|type_label }}</p>
                </div>
                {% endif %}
                {% if shirt.tipologia %}
                <div class="space-y-1">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Shirt Feature') }}</p>
                    <p class="font-medium text-slate-900">{{ shirt.tipologia|feature_label }}</p>
                </div>
                {% endif %}
                {% if shirt.taglia %}
                <div class="space-y-1">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Tag Size') }}</p>
                    <p class="font-medium text-slate-900 uppercase">{{ shirt.taglia }}</p>
                </div>
                {% endif %}
                {% if shirt.colore %}
                <div class="space-y-1">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400">{{ _('Primary Color') }}
                    </p>
                    <p class="font-medium text-slate-900">{{ shirt.colore|color_label }}</p>
                </div>
                {% endif %}

            </div>

            {% if display_description %}
            <div class="mb-16">
                <h3 class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">{{ _('Curator\'s Notes')
                    }}</h3>
                <p class="text-slate-600 leading-relaxed font-light text-lg">
                    {{ display_description }}
                </p>
            </div>
            {% endif %}
            <div class="mt-auto">
                <div class="space-y-6 pt-12 border-t border-slate-100 mb-12">
                    <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400">{{ _('Inquire about this
                        piece') }}</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        {% if whatsapp_number %}
                        <a href="https://wa.me/{{ whatsapp_number }}?text={{ ('Hi! I\'m interested in the ' ~ (shirt.stagione if shirt.stagione else '') ~ ' ' ~ (shirt|team_name_localized) ~ ' ' ~ (shirt.tipologia|feature_label if shirt.tipologia else '') ~ ' ' ~ (shirt.type|type_label_or_shirt) ~ ' from the Kitaly Archive.')|urlencode }}"
                            target="_blank"
                            class="flex items-center justify-center gap-3 py-4 border border-slate-200 rounded-2xl font-bold text-sm tracking-wide text-slate-600 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-900 transition-all active:scale-[0.98]">
                            <i data-lucide="message-circle" class="w-5 h-5"></i> WhatsApp
                        </a>
                        {% endif %}

                        {% if instagram_handle %}
                        <a href="https://instagram.com/{{ instagram_handle }}" target="_blank"
                            class="flex items-center justify-center gap-3 py-4 border border-slate-200 rounded-2xl font-bold text-sm tracking-wide text-slate-600 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-900 transition-all active:scale-[0.98]">
                            <i data-lucide="instagram" class="w-5 h-5"></i> Instagram
                        </a>
                        {% endif %}

                        {% if official_email %}
                        <a href="mailto:{{ official_email }}?subject={{ ('Inquiry: ' ~ (shirt.stagione if shirt.stagione else '') ~ ' ' ~ (shirt|team_name_localized) ~ ' ' ~ (shirt.tipologia|feature_label if shirt.tipologia else '') ~ ' ' ~ (shirt.type|type_label_or_shirt))|urlencode }}"
                            class="sm:col-span-2 flex items-center justify-center gap-3 py-4 border border-slate-200 rounded-2xl font-bold text-sm tracking-wide text-slate-600 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-900 transition-all active:scale-[0.98]">
                            <i data-lucide="mail" class="w-5 h-5"></i> {{ _('Email') }}
                        </a>
                        {% endif %}
                    </div>
                </div>

                <!-- Technical Archive Section (SEO) -->
                <div class="p-8 bg-slate-50/50 rounded-[2.5rem] border border-slate-100/50">
                    <h3 class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-6">{{ _('Archive
                        Metadata') }}</h3>
                    <div class="flex flex-wrap gap-2">
                        {% set keywords = [shirt|team_name_localized, shirt.stagione, shirt.brand, shirt.campionato,
                        shirt.tipologia|feature_label, shirt.type, shirt.taglia, shirt.colore|color_label]|select|list %}
                        {% for kw in keywords %}
                        <span
                            class="px-3 py-1 bg-white border border-slate-100 rounded-full text-[10px] font-medium text-slate-500 uppercase tracking-tighter">
                            {{ kw }}
                        </span>
                        {% endfor %}
                        <span
                            class="px-3 py-1 bg-white border border-slate-100 rounded-full text-[10px] font-medium text-slate-500 uppercase tracking-tighter">Football
                            Heritage</span>
                        <span
                            class="px-3 py-1 bg-white border border-slate-100 rounded-full text-[10px] font-medium text-slate-500 uppercase tracking-tighter">Soccer
                            Jersey</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div id="player-issue-info-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-slate-900/40 backdrop-blur-sm px-6">
    <div class="w-full max-w-lg rounded-[2rem] bg-white shadow-2xl border border-slate-100/70 p-8">
        <div class="flex items-start justify-between gap-6 mb-4">
            <h3 class="font-display font-semibold text-xl text-slate-900">{{ _('Player Issue') }}</h3>
            <button type="button" onclick="closePlayerIssueInfo()"
                class="inline-flex items-center justify-center w-9 h-9 rounded-full bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 transition-colors"
                aria-label="{{ _('Close') }}">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
        </div>
        <p class="text-slate-600 leading-relaxed text-sm">
            {{ _('Player Issue (or Staff issue) means an item that was not sold commercially and was produced specifically for the squad, making them one of the rarest and most sought after pieces in the football world!') }}
        </p>
        <div class="mt-6 flex justify-end">
            <button type="button" onclick="closePlayerIssueInfo()"
                class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl bg-slate-900 text-white text-xs font-bold uppercase tracking-widest hover:bg-italy-600 transition-colors">
                {{ _('Got it') }}
            </button>
        </div>
    </div>
</div>

<script>
    function openPlayerIssueInfo() {
        const modal = document.getElementById('player-issue-info-modal');
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
    }
    function closePlayerIssueInfo() {
        const modal = document.getElementById('player-issue-info-modal');
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }
</script>
{% endblock %}

{% block scripts %}
<script>
    function changeMainImage(src, btn) {
        const mainImg = document.getElementById('main-image');

        // Simple fade transition
        mainImg.style.opacity = '0';
        setTimeout(() => {
            mainImg.src = src;
            mainImg.style.opacity = '1';
        }, 200);

        // Update active state of thumbnails
        document.querySelectorAll('.thumbnail-btn').forEach(b => {
            b.classList.remove('border-italy-600', 'ring-2', 'ring-italy-100', 'opacity-100');
            b.classList.add('border-transparent', 'opacity-60');
        });
        btn.classList.add('border-italy-600', 'ring-2', 'ring-italy-100', 'opacity-100');
        btn.classList.remove('border-transparent', 'opacity-60');
    }
</script>
<style>
    #main-image {
        transition: opacity 0.3s ease-in-out;
    }

    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>
{% endblock %}
