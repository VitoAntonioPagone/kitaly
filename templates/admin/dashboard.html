{% extends "base.html" %}

{% block title %}Dashboard — Curator Panel{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 lg:px-12 py-12">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-8 animate-slide-up">
        <div>
            <h1 class="font-display font-bold text-5xl tracking-tight text-slate-900 mb-2">Inventory Control</h1>
            <p class="text-slate-400 font-medium">Managing {{ shirts|length }} archived masterpieces</p>
        </div>
        <a href="{{ url_for('admin.new_shirt') }}"
            class="inline-flex items-center gap-3 bg-premium-slate text-white px-10 py-5 rounded-[2rem] font-bold text-sm tracking-widest uppercase hover:bg-italy-600 transition-all shadow-xl shadow-slate-200 active:scale-[0.98]">
            <i data-lucide="plus" class="w-5 h-5"></i> {{ _('Add New Item') }}
        </a>
    </div>

    <form action="{{ url_for('admin.dashboard') }}" method="GET"
        class="mb-12 bg-white rounded-[2rem] border border-slate-100/70 shadow-sm px-6 py-6 animate-slide-up"
        style="animation-delay: 0.05s">
        <div class="grid grid-cols-1 lg:grid-cols-6 gap-6 items-end">
            <div class="lg:col-span-2">
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{
                    _('Search') }}</label>
                <div class="relative">
                    <i data-lucide="search"
                        class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                    <input type="text" name="q" value="{{ request.args.get('q', '') }}"
                        placeholder="Search by name or product code..."
                        class="w-full pl-9 pr-3 py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm">
                </div>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Brand')
                    }}</label>
                <select name="brand"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Brands') }}</option>
                    {% for b in brands %}
                    <option value="{{ b }}" {% if request.args.get('brand')==b %}selected{% endif %}>{{ b }} ({{
                        brand_counts.get(b, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('League')
                    }}</label>
                <select name="campionato"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Leagues') }}</option>
                    {% for league in campionati %}
                    <option value="{{ league }}" {% if request.args.get('campionato')==league %}selected{% endif %}>
                        {{ league|competition_label_localized }} ({{ league_counts.get(league, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Season')
                    }}</label>
                <select name="stagione"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Seasons') }}</option>
                    {% for s in stagioni %}
                    <option value="{{ s }}" {% if request.args.get('stagione')==s %}selected{% endif %}>{{ s }} ({{
                        season_counts.get(s, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Type')
                    }}</label>
                <select name="type"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Types') }}</option>
                    {% for t in types %}
                    <option value="{{ t }}" {% if request.args.get('type')==t %}selected{% endif %}>{{
                        t|type_label }} ({{ type_counts.get(t, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Color')
                    }}</label>
                <select name="colore"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Colors') }}</option>
                    {% for c in colori %}
                    <option value="{{ c }}" {% if request.args.get('colore')==c %}selected{% endif %}>{{ c }} ({{
                        color_counts.get(c, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Size')
                    }}</label>
                <select name="taglia"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Sizes') }}</option>
                    {% for size in taglie %}
                    <option value="{{ size }}" {% if request.args.get('taglia')==size %}selected{% endif %}>{{ size }} ({{
                        size_counts.get(size, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="lg:col-span-2">
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Team')
                    }}</label>
                <select name="squadra"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="">{{ _('All Teams') }}</option>
                    {% for sq in squadre %}
                    <option value="{{ sq }}" {% if request.args.get('squadra')==sq %}selected{% endif %}>{{ sq }} ({{
                        team_counts.get(sq, 0) }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">{{ _('Sort')
                    }}</label>
                <select name="sort"
                    class="w-full py-2.5 rounded-xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none text-sm cursor-pointer">
                    <option value="newest" {% if request.args.get('sort')=='newest' %}selected{% endif %}>{{
                        _('Latest Arrival') }}</option>
                    <option value="chronological" {% if request.args.get('sort', 'chronological') in
                        ['chronological', 'oldest'] %}selected{% endif %}>
                        {{ _('Timeline') }}
                    </option>
                    <option value="reverse_chronological" {% if request.args.get('sort')=='reverse_chronological' %}selected{% endif %}>
                        Reverse Timeline
                    </option>
                </select>
            </div>
            <div class="flex gap-3">
                <button type="submit"
                    class="w-full inline-flex items-center justify-center gap-2 bg-slate-900 text-white px-4 py-2.5 rounded-xl font-bold text-xs tracking-widest uppercase hover:bg-italy-600 transition-all">
                    {{ _('Apply') }}
                </button>
            </div>
            <div>
                <a href="{{ url_for('admin.dashboard') }}"
                    class="inline-flex items-center justify-center w-full px-4 py-2.5 rounded-xl border border-slate-200 text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-italy-600 hover:border-italy-100 transition-all">
                    {{ _('Reset') }}
                </a>
            </div>
        </div>
    </form>

    <div class="mb-4 animate-slide-up" style="animation-delay: 0.08s">
        <button type="button" id="overview-toggle"
            class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl border border-slate-200 text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-italy-600 hover:border-italy-100 transition-all">
            <span>Overview</span>
            <i id="overview-toggle-icon" data-lucide="chevron-down" class="w-4 h-4 transition-transform"></i>
        </button>
    </div>
    <div id="overview-section" class="mb-12 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 animate-slide-up hidden" style="animation-delay: 0.08s">
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Seasons</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in season_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Types</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in type_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value|type_label }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Teams</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in team_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Brands</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in brand_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Leagues</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in league_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Colors</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in color_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="rounded-3xl border border-slate-100 bg-white p-6">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4">Sizes</p>
            <div class="max-h-52 overflow-y-auto pr-2 space-y-2">
                {% for value, total in size_totals %}
                <div class="flex items-center justify-between text-sm">
                    <span class="text-slate-700">{{ value }}</span>
                    <span class="text-slate-400 font-semibold">{{ total }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Inventory Table -->
    <div class="bg-white rounded-[3.5rem] shadow-2xl shadow-slate-100/50 border border-slate-100/50 overflow-hidden animate-slide-up"
        style="animation-delay: 0.1s">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-slate-50/50 border-b border-slate-100">
                        <th class="px-10 py-8 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">{{
                            _('Piece') }}</th>
                        <th
                            class="px-10 py-8 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] hidden md:table-cell">
                            {{ _('Specifications') }}</th>
                        <th
                            class="px-10 py-8 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] hidden lg:table-cell">
                            {{ _('Status') }}</th>
                        <th
                            class="px-10 py-8 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] text-right">
                            {{ _('Manage') }}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% for shirt in shirts %}
                    <tr class="group hover:bg-slate-50/30 transition-all duration-500">
                        <td class="px-10 py-8">
                            <div class="flex items-center gap-6">
                                <div
                                    class="w-16 h-20 rounded-2xl bg-slate-100 overflow-hidden flex-shrink-0 shadow-sm group-hover:shadow-md transition-shadow duration-500">
                                    {% if shirt.cover_image %}
                                    <img src="{{ url_for('uploaded_file', filename=shirt.cover_image.file_path) }}"
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                    {% else %}
                                    <div class="w-full h-full flex items-center justify-center text-slate-300">
                                        <i data-lucide="image" class="w-6 h-6 stroke-[1.5]"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="space-y-1">
                                    <h3
                                        class="font-display font-bold text-lg tracking-tight text-slate-900 leading-tight">
                                        {% if shirt.player_name %}{{ shirt.player_name }} - {% endif %}{{
                                        shirt|team_name_localized }}</h3>
                                    <p class="text-[10px] font-bold uppercase tracking-widest text-italy-600">ID: {{
                                        shirt.product_code }}</p>
                                    <p class="text-xs font-medium text-slate-400">{{ shirt.stagione }}</p>
                                    {% set type_value = shirt.type if shirt.type and shirt.type|lower != 'none' else '' %}
                                    {% if type_value %}
                                    <p class="text-xs font-medium text-slate-500">
                                        {{ type_value|type_label }} — {{ shirt.tipologia }}
                                    </p>
                                    {% else %}
                                    <p class="text-xs font-medium text-slate-500">{{ shirt.tipologia }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </td>
                        <td class="px-10 py-8 hidden md:table-cell">
                            <div class="space-y-1">
                                <p class="text-sm font-semibold text-slate-700">{{ shirt.brand }}</p>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{{
                                    shirt.taglia }}</p>
                            </div>
                        </td>
                        <td class="px-10 py-8 hidden lg:table-cell">
                            <span
                                class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest
                                       {% if shirt.status == 'active' %}bg-emerald-50 text-emerald-600{% else %}bg-slate-100 text-slate-500{% endif %}">
                                <span
                                    class="h-1.5 w-1.5 rounded-full {% if shirt.status == 'active' %}bg-emerald-500{% else %}bg-slate-400{% endif %}"></span>
                                {{ 'Active' if shirt.status == 'active' else 'Draft' }}
                            </span>
                        </td>
                        <td class="px-10 py-8">
                            <div
                                class="flex justify-end gap-3 opacity-40 group-hover:opacity-100 transition-opacity duration-300">
                                <a href="{{ url_for('public.shirt_detail', shirt_id=shirt.id) }}"
                                    class="p-3 bg-white border border-slate-100 text-slate-400 hover:text-italy-600 hover:border-italy-100 rounded-2xl transition-all shadow-sm"
                                    title="View Source">
                                    <i data-lucide="arrow-up-right" class="w-5 h-5"></i>
                                </a>
                                <a href="{{ url_for('admin.edit_shirt', shirt_id=shirt.id) }}"
                                    class="p-3 bg-white border border-slate-100 text-slate-400 hover:text-italy-600 hover:border-italy-100 rounded-2xl transition-all shadow-sm"
                                    title="Modify Record">
                                    <i data-lucide="edit-3" class="w-5 h-5"></i>
                                </a>
                                <form action="{{ url_for('admin.delete_shirt', shirt_id=shirt.id) }}" method="POST"
                                    class="contents" onsubmit="return confirm('Really delete this masterpiece?')">
                                    <button type="submit"
                                        class="p-3 bg-white border border-slate-100 text-slate-400 hover:text-red-500 hover:border-red-100 rounded-2xl transition-all shadow-sm"
                                        title="Eliminate Record">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="px-10 py-32 text-center">
                            <div
                                class="inline-flex items-center justify-center w-20 h-20 rounded-[2rem] bg-slate-50 text-slate-200 mb-8">
                                <i data-lucide="archive" class="w-10 h-10 stroke-[1]"></i>
                            </div>
                            <h3 class="font-display font-semibold text-xl text-slate-900 mb-2">The Archive is empty</h3>
                            <p class="text-slate-400 mb-10 italic">Start cataloging your first legendary shirt today.
                            </p>
                            <a href="{{ url_for('admin.new_shirt') }}"
                                class="inline-flex py-4 px-10 border-2 border-slate-100 text-slate-400 rounded-full font-bold text-sm tracking-widest uppercase hover:text-italy-600 hover:border-italy-100 transition-all">
                                {{ _('Begin Collection') }}
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('overview-toggle');
        const section = document.getElementById('overview-section');
        const icon = document.getElementById('overview-toggle-icon');

        if (!toggle || !section || !icon) {
            return;
        }

        toggle.addEventListener('click', () => {
            const isHidden = section.classList.contains('hidden');
            section.classList.toggle('hidden', !isHidden);
            icon.classList.toggle('rotate-180', isHidden);
        });
    });
</script>
{% endblock %}
