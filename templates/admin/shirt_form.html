{% extends "base.html" %}

{% block title %}{{ 'Archive Modify' if shirt else 'New Record' }} — Kitaly Archive{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-12 px-6">
    <div class="flex items-center gap-6 mb-16 animate-slide-up">
        <a href="{{ url_for('admin.dashboard') }}"
            class="group p-4 bg-white rounded-2xl border border-slate-100 text-slate-300 hover:text-italy-600 hover:border-italy-100 transition-all shadow-sm">
            <i data-lucide="arrow-left" class="w-6 h-6 transition-transform group-hover:-translate-x-1"></i>
        </a>
        <div>
            <h1 class="font-display font-bold text-4xl tracking-tight text-slate-900">{{ 'Modify Entry' if shirt else
                'Create Entry' }}</h1>
            <p class="text-xs font-bold uppercase tracking-[0.2em] text-slate-400 mt-1">{{ _('Physical Archive System')
                }}</p>
        </div>
    </div>

    <form id="shirt-form" method="POST" enctype="multipart/form-data" class="space-y-12">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20">

            <div class="lg:col-span-7 space-y-12 animate-slide-up" style="animation-delay: 0.1s">

                <section class="space-y-8">
                    <div class="flex items-center gap-4 border-b border-slate-100 pb-4">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest text-italy-600 bg-italy-50 px-2 py-1 rounded">01</span>
                        <h2 class="text-xs font-bold uppercase tracking-widest text-slate-900">{{ _('Core Identity') }}
                        </h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="md:col-span-2 space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Player Name') }} <span class="text-slate-300">({{ _('Optional') }})</span></label>
                            <input type="text" name="player_name" value="{{ shirt.player_name if shirt else '' }}"
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                placeholder="{{ _('e.g. Buffon, Del Piero, Totti...') }}">
                        </div>

                        <div class="md:col-span-2 space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Organization / Team') }}</label>
                            <input type="text" name="squadra" value="{{ shirt.squadra if shirt else '' }}" required
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                placeholder="{{ _('e.g. Juventus, Italy National Team...') }}">
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Brand') }}</label>
                            <input type="text" name="brand" list="brands-list"
                                value="{{ shirt.brand if shirt else '' }}" required
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                placeholder="{{ _('Select or type...') }}">
                            <datalist id="brands-list">
                                {% for b in brands %}
                                <option value="{{ b }}">
                                    {% endfor %}
                            </datalist>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Season Period') }}</label>
                            <input type="text" name="stagione" value="{{ shirt.stagione if shirt else '' }}"
                                placeholder="1994-95" required
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900 uppercase tracking-tighter">
                        </div>
                    </div>
                </section>

                <section class="space-y-8">
                    <div class="flex items-center gap-4 border-b border-slate-100 pb-4">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest text-italy-600 bg-italy-50 px-2 py-1 rounded">02</span>
                        <h2 class="text-xs font-bold uppercase tracking-widest text-slate-900">{{ _('Technical
                            Specifications') }}</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Campionato / Context') }}</label>
                            <input type="text" name="campionato" list="leagues-list"
                                value="{{ shirt.campionato if shirt else '' }}" required
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                placeholder="{{ _('Select competition...') }}">
                            <datalist id="leagues-list">
                                {% for l in leagues %}
                                <option value="{{ l }}">
                                    {% endfor %}
                            </datalist>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Tipologia / Edition') }}</label>
                            <select name="tipologia"
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900 appearance-none cursor-pointer">
                                <option value="Home" {{ 'selected' if shirt and shirt.tipologia=='Home' }}>Home</option>
                                <option value="Away" {{ 'selected' if shirt and shirt.tipologia=='Away' }}>Away</option>
                                <option value="Third" {{ 'selected' if shirt and shirt.tipologia=='Third' }}>Third
                                </option>
                                <option value="GK" {{ 'selected' if shirt and shirt.tipologia=='GK' }}>GK</option>
                                <option value="Special" {{ 'selected' if shirt and shirt.tipologia=='Special' }}>Special
                                </option>
                            </select>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Sleeve Type') }}</label>
                            <select name="maniche"
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900 appearance-none cursor-pointer">
                                <option value="S/S" {{ 'selected' if shirt and shirt.maniche=='S/S' }}>S/S (Short
                                    Sleeve)</option>
                                <option value="L/S" {{ 'selected' if shirt and shirt.maniche=='L/S' }}>L/S (Long Sleeve)
                                </option>
                            </select>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Size Profile') }}</label>
                            <div class="flex flex-wrap gap-2">
                                {% for s in ['S', 'M', 'L', 'XL', 'XXL'] %}
                                <label class="cursor-pointer">
                                    <input type="radio" name="taglia" value="{{ s }}" {{ 'checked' if (shirt and
                                        shirt.taglia==s) or (not shirt and s=='L' ) }} class="peer hidden">
                                    <div
                                        class="px-5 py-3 rounded-xl border border-slate-100 bg-slate-50 text-slate-400 font-bold text-xs peer-checked:bg-premium-slate peer-checked:text-white peer-checked:border-premium-slate transition-all active:scale-95 uppercase tracking-widest">
                                        {{ s }}
                                    </div>
                                </label>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Primary Tones') }}</label>
                            <input type="text" name="colore" id="color-input" list="colors-list"
                                value="{{ shirt.colore if shirt else '' }}" required
                                class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                placeholder="{{ _('e.g. Navy, Amaranto...') }}">
                            <datalist id="colors-list">
                                {% for c in colors %}
                                <option value="{{ c }}">
                                    {% endfor %}
                            </datalist>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-6 pt-2">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <div class="relative">
                                <input type="checkbox" name="player_issued" value="1" {{ 'checked' if shirt and
                                    shirt.player_issued }} class="peer hidden">
                                <div
                                    class="w-10 h-6 bg-slate-200 rounded-full peer-checked:bg-emerald-500 transition-colors">
                                </div>
                                <div
                                    class="absolute inset-y-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4">
                                </div>
                            </div>
                            <span
                                class="text-xs font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-600 transition-colors">Player
                                Issue</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <div class="relative">
                                <input type="checkbox" name="nazionale" value="1" {{ 'checked' if shirt and
                                    shirt.nazionale }} class="peer hidden">
                                <div
                                    class="w-10 h-6 bg-slate-200 rounded-full peer-checked:bg-italy-600 transition-colors">
                                </div>
                                <div
                                    class="absolute inset-y-1 left-1 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4">
                                </div>
                            </div>
                            <span
                                class="text-xs font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-600 transition-colors">National
                                team</span>
                        </label>
                    </div>
                </section>

                <section class="space-y-8">
                    <div class="flex items-center gap-4 border-b border-slate-100 pb-4">
                        <span
                            class="text-[10px] font-bold uppercase tracking-widest text-italy-600 bg-italy-50 px-2 py-1 rounded">03</span>
                        <h2 class="text-xs font-bold uppercase tracking-widest text-slate-900">{{ _('Curator\'s
                            Insight') }}</h2>
                    </div>

                    <div class="space-y-8">
                        <div class="space-y-2">
                            <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                _('Archival Description') }}</label>
                            <textarea name="descrizione" rows="4"
                                class="w-full px-6 py-4 rounded-3xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-light text-slate-600 text-lg leading-relaxed"
                                placeholder="{{ _('Describe historical significance, unique details...') }}">{{ shirt.descrizione if shirt else '' }}</textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                    _('Valuation (€)') }}</label>
                                <input type="number" step="0.01" name="prezzo_pagato"
                                    value="{{ shirt.prezzo_pagato if shirt else '' }}"
                                    class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900"
                                    placeholder="0.00">
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1">{{
                                    _('Visibility Status') }}</label>
                                <select name="status"
                                    class="w-full px-6 py-4 rounded-2xl bg-slate-50 border border-transparent focus:bg-white focus:border-italy-600 focus:ring-4 focus:ring-italy-100 outline-none transition-all font-medium text-slate-900 appearance-none cursor-pointer">
                                    <option value="active" {{ 'selected' if not shirt or shirt.status=='active' }}>
                                        Visible</option>
                                    <option value="draft" {{ 'selected' if shirt and shirt.status=='draft' }}>Archived /
                                        Draft</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-5 space-y-12 animate-slide-up" style="animation-delay: 0.2s">
                <section
                    class="bg-white p-10 rounded-[3rem] shadow-2xl shadow-slate-200/50 border border-slate-100/50 space-y-10 sticky top-32">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xs font-bold uppercase tracking-widest text-slate-900">{{ _('Media Archive') }}
                        </h2>
                        <i data-lucide="camera" class="w-4 h-4 text-slate-300"></i>
                    </div>

                    <div id="dropzone"
                        class="relative group rounded-[2.5rem] border-2 border-dashed border-slate-100 p-10 text-center transition-all hover:border-italy-400 hover:bg-italy-50/10 cursor-pointer overflow-hidden">
                        <div class="relative z-10 flex flex-col items-center gap-6">
                            <div
                                class="w-20 h-20 rounded-[1.5rem] bg-slate-50 text-slate-300 group-hover:bg-italy-100 group-hover:text-italy-600 transition-all duration-500 flex items-center justify-center shadow-inner">
                                <i data-lucide="upload-cloud" class="w-10 h-10 stroke-[1.5]"></i>
                            </div>
                            <div class="space-y-2">
                                <p class="font-display font-semibold text-slate-900 text-lg">Transfer Media</p>
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">DRAG IMAGES OR
                                    CLICK TO SELECT</p>
                            </div>
                            <input type="file" name="images" id="image-input" multiple accept="image/*" class="hidden">
                        </div>
                        <div
                            class="absolute top-0 right-0 -mr-12 -mt-12 w-32 h-32 bg-italy-50 rounded-full blur-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                        </div>
                    </div>

                    <div id="preview-container" class="grid grid-cols-1 gap-6">
                    </div>

                    {% if shirt and shirt.images %}
                    <div class="space-y-6 pt-10 border-t border-slate-100">
                        <p class="text-[10px] font-bold uppercase tracking-widest text-slate-400 italic">Current Records
                        </p>
                        <div class="grid grid-cols-2 gap-6">
                            {% for img in shirt.images %}
                            <div
                                class="relative group aspect-[4/5] rounded-[2rem] overflow-hidden border border-slate-100 shadow-sm transition-all duration-500 hover:shadow-lg">
                                <img src="{{ url_for('uploaded_file', filename=img.file_path) }}"
                                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">

                                <div
                                    class="absolute inset-0 bg-italy-900/40 opacity-0 group-hover:opacity-100 transition-all duration-500 flex items-center justify-center gap-3">
                                    <form action="{{ url_for('admin.delete_image', image_id=img.id) }}" method="POST"
                                        class="contents">
                                        <button type="submit"
                                            class="p-4 bg-white/20 backdrop-blur-md text-white rounded-2xl hover:bg-red-500 transition-all active:scale-95 shadow-lg">
                                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                                        </button>
                                    </form>
                                </div>

                                {% if img.is_cover %}
                                <div
                                    class="absolute top-4 left-4 px-3 py-1 bg-white/90 backdrop-blur-md text-italy-600 text-[10px] font-bold rounded-full uppercase tracking-widest shadow-sm">
                                    {{ _('Primary') }}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="pt-10">
                        <button type="submit"
                            class="w-full py-6 bg-premium-slate text-white rounded-[2rem] font-bold text-sm tracking-widest uppercase hover:bg-italy-600 transition-all shadow-xl shadow-slate-200 active:scale-[0.98] flex items-center justify-center gap-3">
                            <i data-lucide="save" class="w-5 h-5"></i> {{ _('Commit Changes') }}
                        </button>
                        <a href="{{ url_for('admin.dashboard') }}"
                            class="block w-full text-center py-5 text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 hover:text-red-500 transition-colors mt-4">
                            {{ _('Cancel Operation') }}
                        </a>
                    </div>
                </section>
            </div>
        </div>
        <input type="hidden" name="cover_index" id="cover-index" value="0">
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    const dropzone = document.getElementById('dropzone');
    const imageInput = document.getElementById('image-input');
    const previewContainer = document.getElementById('preview-container');
    const coverIndexInput = document.getElementById('cover-index');

    dropzone.addEventListener('click', () => imageInput.click());

    imageInput.addEventListener('change', function () {
        previewContainer.innerHTML = '';
        const files = Array.from(this.files);

        files.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const div = document.createElement('div');
                div.className = 'animate-slide-up relative aspect-[4/5] rounded-[2.5rem] overflow-hidden border-2 ' + (index === 0 ? 'border-italy-600 shadow-xl' : 'border-slate-100');
                div.innerHTML = `
                    <img src="${e.target.result}" class="w-full h-full object-cover">
                    <div class="absolute top-4 left-4 px-3 py-1 bg-white/90 backdrop-blur-md text-italy-600 text-[10px] font-bold rounded-full uppercase tracking-widest shadow-sm">
                        ${index === 0 ? '{{ _("Primary Selection") }}' : '{{ _("Additional View") }}'}
                    </div>
                `;
                previewContainer.appendChild(div);
                lucide.createIcons();
            }
            reader.readAsDataURL(file);
        });
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => dropzone.classList.add('border-italy-400', 'bg-italy-50/10'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, () => dropzone.classList.remove('border-italy-400', 'bg-italy-50/10'), false);
    });

    dropzone.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        imageInput.files = dt.files;
        imageInput.dispatchEvent(new Event('change'));
    });
</script>
{% endblock %}